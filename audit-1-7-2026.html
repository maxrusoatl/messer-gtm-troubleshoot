<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Messer Checkout Audit 2026-01-07</title>
  <style>
    :root {
      --bg: #0f1115;
      --panel: #151922;
      --ink: #e6e9ef;
      --muted: #aab0bd;
      --accent: #79c2ff;
      --warn: #ffb347;
      --crit: #ff6b6b;
      --ok: #8bd88b;
      --border: #2a3140;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--ink);
      font-family: "IBM Plex Sans", "Segoe UI", sans-serif;
      line-height: 1.45;
    }
    header {
      padding: 32px 24px 16px;
      border-bottom: 1px solid var(--border);
      background: linear-gradient(180deg, #141b2a, #0f1115 60%);
    }
    h1 { margin: 0 0 6px; font-size: 26px; letter-spacing: 0.2px; }
    .subtitle { color: var(--muted); font-size: 14px; }
    main { padding: 24px; max-width: 1100px; margin: 0 auto; }
    section { margin: 0 0 28px; }
    h2 { font-size: 18px; margin: 0 0 12px; }
    .card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 16px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }
    th, td {
      padding: 10px 8px;
      border-bottom: 1px solid var(--border);
      vertical-align: top;
      text-align: left;
    }
    th { color: var(--muted); font-weight: 600; }
    .pill {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.2px;
    }
    .crit { background: rgba(255, 107, 107, 0.2); color: var(--crit); }
    .high { background: rgba(255, 179, 71, 0.2); color: var(--warn); }
    .med { background: rgba(121, 194, 255, 0.2); color: var(--accent); }
    .low { background: rgba(139, 216, 139, 0.2); color: var(--ok); }
    pre {
      background: #0c0f14;
      border: 1px solid var(--border);
      padding: 10px;
      border-radius: 8px;
      overflow: auto;
      white-space: pre-wrap;
      color: #d7dce6;
      font-size: 12px;
    }
    ul { margin: 0; padding-left: 18px; }
    .muted { color: var(--muted); }
  </style>
</head>
<body>
  <header>
    <h1>Checkout Gap Audit</h1>
    <div class="subtitle">Scope: Chrome console log + checkout dataLayer export + product view dataLayer snippet (2026-01-07)</div>
  </header>
  <main>
    <section class="card">
      <h2>Inputs</h2>
      <ul>
        <li><code>console chrome messeer.md</code></li>
        <li><code>checkout messer datalayer.json</code></li>
        <li>Inline dataLayer snippet (product view_item)</li>
        <li>Screenshots (WP Rocket exclusions, Cloudflare worker HTTP 400) â€” not machine-readable in this workspace</li>
      </ul>
    </section>

    <section class="card">
      <h2>Primary Gaps</h2>
      <table>
        <thead>
          <tr>
            <th>Severity</th>
            <th>Gap</th>
            <th>Evidence</th>
            <th>Impact</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><span class="pill crit">Critical</span></td>
            <td>/metrics requests return 400</td>
            <td>
              <pre>metrics/data?v=2&event=begin_checkout:1  Failed to load resource: the server responded with a status of 400 ()
metrics/281sqstbcsp?...:1  Failed to load resource: the server responded with a status of 400 ()</pre>
              <div class="muted">Source: console chrome messeer.md</div>
            </td>
            <td>Breaks SOP ingestion path; events do not reach sGTM.</td>
          </tr>
          <tr>
            <td><span class="pill high">High</span></td>
            <td>Duplicate Meta Pixel ID detected</td>
            <td>
              <pre>[Meta Pixel] - Duplicate Pixel ID: 3695834564032094.</pre>
              <div class="muted">Source: console chrome messeer.md</div>
            </td>
            <td>Causes double firing and unreliable dedup.</td>
          </tr>
          <tr>
            <td><span class="pill high">High</span></td>
            <td>Stripe.js loaded more than once</td>
            <td>
              <pre>[Stripe.js] It looks like Stripe.js was loaded more than one time. Please only load it once per page.</pre>
              <div class="muted">Source: console chrome messeer.md</div>
            </td>
            <td>Checkout errors and duplicate handlers are possible.</td>
          </tr>
          <tr>
            <td><span class="pill high">High</span></td>
            <td>DataLayer user_id timing mismatch</td>
            <td>
              <pre>begin_checkout has user_data: []
user_data objects appear later with user_id: null and email/phone updates</pre>
              <div class="muted">Source: checkout messer datalayer.json</div>
            </td>
            <td>Server-side user_id and user_data can be missing at event time.</td>
          </tr>
          <tr>
            <td><span class="pill high">High</span></td>
            <td>view_item fires before user_data is populated</td>
            <td>
              <pre>event: view_item -> user_data: []
event: user_init -> user_id set separately</pre>
              <div class="muted">Source: dataLayer text (product view_item snippet)</div>
            </td>
            <td>User identifiers are not attached to view_item events.</td>
          </tr>
          <tr>
            <td><span class="pill med">Medium</span></td>
            <td>Mixed ecommerce schemas on checkout</td>
            <td>
              <pre>event: checkout -> ecommerce.currencyCode + items.id/name/price
event: begin_checkout -> ecommerce.currency + items.item_id/item_name/price</pre>
              <div class="muted">Source: checkout messer datalayer.json</div>
            </td>
            <td>Tags expecting GA4 schema may ignore the checkout event.</td>
          </tr>
          <tr>
            <td><span class="pill med">Medium</span></td>
            <td>Duplicate DOM IDs on checkout</td>
            <td>
              <pre>Found 2 elements with non-unique id #place_order
Found 2 elements with non-unique id #woocommerce-process-checkout-nonce</pre>
              <div class="muted">Source: console chrome messeer.md</div>
            </td>
            <td>Can break DOM selectors used by scripts or tags.</td>
          </tr>
          <tr>
            <td><span class="pill med">Medium</span></td>
            <td>Multiple GTM container init events</td>
            <td>
              <pre>gtm.js count = 3 in checkout export
gtm.js count = 3 in product view snippet</pre>
              <div class="muted">Source: checkout messer datalayer.json; dataLayer text (product view_item snippet)</div>
            </td>
            <td>May indicate duplicate container injection; requires verification.</td>
          </tr>
          <tr>
            <td><span class="pill med">Medium</span></td>
            <td>Consent updates occur after view_item</td>
            <td>
              <pre>view_item appears before cmplz_event_* entries in the product view snippet</pre>
              <div class="muted">Source: dataLayer text (product view_item snippet)</div>
            </td>
            <td>If default consent is denied, early events may be blocked.</td>
          </tr>
          <tr>
            <td><span class="pill med">Medium</span></td>
            <td>Consent state indicates opt-out during checkout</td>
            <td>
              <pre>complianz.min.js ... opt-out</pre>
              <div class="muted">Source: console chrome messeer.md</div>
            </td>
            <td>Tracking may be gated depending on consent config.</td>
          </tr>
          <tr>
            <td><span class="pill low">Low</span></td>
            <td>Sandboxed frames block script execution</td>
            <td>
              <pre>Blocked script execution in '<URL>' because the document's frame is sandboxed and the 'allow-scripts' permission is not set.</pre>
              <div class="muted">Source: console chrome messeer.md</div>
            </td>
            <td>Third-party widgets inside sandboxed frames cannot run scripts.</td>
          </tr>
          <tr>
            <td><span class="pill low">Low</span></td>
            <td>view_item items lack explicit quantity</td>
            <td>
              <pre>view_item items include price but no quantity field</pre>
              <div class="muted">Source: dataLayer text (product view_item snippet)</div>
            </td>
            <td>Defaults to quantity = 1; add if needed for reporting accuracy.</td>
          </tr>
        </tbody>
      </table>
    </section>

    <section class="card">
      <h2>DataLayer Summary (Checkout)</h2>
      <ul>
        <li>Events present: <code>checkout</code>, <code>begin_checkout</code>, <code>user_init</code>, consent events, GTM lifecycle events.</li>
        <li><code>begin_checkout</code> includes GA4-style ecommerce with currency, value, and items.</li>
        <li><code>checkout</code> uses currencyCode + legacy item fields (id/name/price).</li>
        <li>No <code>transaction_id</code> present in the checkout or begin_checkout events.</li>
      </ul>
    </section>

    <section class="card">
      <h2>DataLayer Summary (Product View)</h2>
      <ul>
        <li>Events present: <code>view_item</code>, <code>user_init</code>, GTM lifecycle events, and Complianz consent events.</li>
        <li><code>view_item</code> includes GA4-style ecommerce with currency, value, and items.</li>
        <li><code>user_id</code> appears only in <code>user_init</code>; <code>view_item</code> has <code>user_data: []</code>.</li>
      </ul>
    </section>

    <section class="card">
      <h2>Open Questions / Needed Evidence</h2>
      <ul>
        <li>Why /metrics returns 400 (request payload and server response body are not visible in current inputs).</li>
        <li>Whether GTM is injected multiple times or just re-initialized by a script.</li>
        <li>Whether consent opt-out is expected on checkout (Complianz configuration not provided).</li>
        <li>WP Rocket exclusion settings in text or export (screenshots are not machine-readable here).</li>
        <li>Cloudflare worker response body for /metrics and worker route (screenshot not machine-readable here).</li>
      </ul>
    </section>
  </main>
</body>
</html>
