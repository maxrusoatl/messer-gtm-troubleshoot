<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Messer GTM Dashboard</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #1a1a2e;
      min-height: 100vh;
      overflow-x: auto;
      color: #e0e0e0;
    }

    /* Navigation Menu */
    .nav-menu {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 50px;
      background: #0f0f1a;
      border-bottom: 1px solid #2d3a5a;
      display: flex;
      align-items: center;
      padding: 0 20px;
      z-index: 1000;
      gap: 20px;
    }

    .nav-logo {
      font-size: 16px;
      font-weight: 700;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .nav-logo-icon {
      width: 28px;
      height: 28px;
      background: linear-gradient(135deg, #4caf50, #2196f3);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
    }

    .nav-links {
      display: flex;
      gap: 5px;
    }

    .nav-link {
      padding: 8px 16px;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 500;
      color: #aaa;
      text-decoration: none;
      transition: all 0.2s;
    }

    .nav-link:hover {
      background: #16213e;
      color: #fff;
    }

    .nav-link.active {
      background: #2196f3;
      color: #fff;
    }

    .nav-status {
      margin-left: auto;
      display: flex;
      gap: 10px;
    }

    .nav-badge {
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
    }

    .nav-badge.critical { background: #f44336; color: #fff; }
    .nav-badge.medium { background: #ff9800; color: #fff; }
    .nav-badge.verified { background: #4caf50; color: #fff; }

    /* Canvas Grid Layout */
    .canvas-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      padding: 70px 20px 20px 20px;
      min-width: 1800px;
    }

    .canvas-header {
      grid-column: 1 / -1;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 15px 25px;
      background: linear-gradient(135deg, #16213e 0%, #1a1a2e 100%);
      border-radius: 12px;
      border: 1px solid #2d3a5a;
    }

    .canvas-title {
      font-size: 22px;
      font-weight: 600;
      color: #fff;
    }

    .status-badges {
      display: flex;
      gap: 12px;
    }

    .status-badge {
      padding: 6px 16px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    .status-badge.critical { background: #f44336; color: #fff; }
    .status-badge.medium { background: #ff9800; color: #fff; }
    .status-badge.verified { background: #4caf50; color: #fff; }

    /* Diagram Panels */
    .diagram-panel {
      background: #16213e;
      border-radius: 16px;
      border: 1px solid #2d3a5a;
      overflow: hidden;
    }

    .diagram-panel.full-width {
      grid-column: 1 / -1;
    }

    .panel-header {
      padding: 15px 20px;
      background: #0f3460;
      border-bottom: 1px solid #2d3a5a;
      font-size: 14px;
      font-weight: 600;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .panel-header .icon {
      width: 28px;
      height: 28px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
    }

    .panel-content {
      padding: 20px;
      min-height: 300px;
    }

    /* ========== DIAGRAM 1: END-TO-END FLOW ========== */
    .e2e-flow {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 30px 0;
      overflow-x: auto;
    }

    .flow-node {
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 120px;
    }

    .flow-node-box {
      width: 100px;
      height: 100px;
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      border: 3px solid;
      transition: all 0.3s;
    }

    .flow-node-box.source {
      background: linear-gradient(135deg, #1e3a5f 0%, #16213e 100%);
      border-color: #2196f3;
    }

    .flow-node-box.wgtm {
      background: linear-gradient(135deg, #3d2914 0%, #16213e 100%);
      border-color: #ff9800;
    }

    .flow-node-box.proxy {
      background: linear-gradient(135deg, #3d1f33 0%, #16213e 100%);
      border-color: #e91e63;
    }

    .flow-node-box.sgtm {
      background: linear-gradient(135deg, #1d3d2b 0%, #16213e 100%);
      border-color: #4caf50;
    }

    .flow-node-box.dest {
      background: linear-gradient(135deg, #2a2a5a 0%, #16213e 100%);
      border-color: #9c27b0;
    }

    .flow-node-box.error {
      border-color: #f44336;
      box-shadow: 0 0 20px rgba(244, 67, 54, 0.4);
      animation: pulse-error 2s infinite;
    }

    @keyframes pulse-error {
      0%, 100% { box-shadow: 0 0 20px rgba(244, 67, 54, 0.4); }
      50% { box-shadow: 0 0 40px rgba(244, 67, 54, 0.6); }
    }

    .flow-node-icon {
      font-size: 28px;
      margin-bottom: 5px;
    }

    .flow-node-label {
      font-size: 11px;
      font-weight: 600;
      text-align: center;
    }

    .flow-node-id {
      font-size: 9px;
      color: #888;
      margin-top: 8px;
    }

    .flow-arrow {
      flex: 1;
      height: 3px;
      background: linear-gradient(90deg, #2d3a5a, #4a5a8a);
      position: relative;
      min-width: 60px;
      max-width: 120px;
    }

    .flow-arrow::after {
      content: '';
      position: absolute;
      right: 0;
      top: -5px;
      border: 6px solid transparent;
      border-left-color: #4a5a8a;
    }

    .flow-arrow.success {
      background: linear-gradient(90deg, #2e7d32, #4caf50);
    }

    .flow-arrow.success::after {
      border-left-color: #4caf50;
    }

    .flow-arrow.error {
      background: linear-gradient(90deg, #c62828, #f44336);
    }

    .flow-arrow.error::after {
      border-left-color: #f44336;
    }

    .flow-arrow-label {
      position: absolute;
      top: -22px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 10px;
      color: #888;
      white-space: nowrap;
    }

    /* ========== Internal Diagrams ========== */
    .wgtm-internal, .sgtm-internal {
      display: grid;
      grid-template-columns: 1fr 60px 1fr 60px 1fr;
      gap: 15px;
      align-items: start;
    }

    .wgtm-column, .sgtm-column {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .wgtm-column-title, .sgtm-column-title {
      font-size: 11px;
      font-weight: 600;
      color: #888;
      text-transform: uppercase;
      text-align: center;
      padding-bottom: 8px;
      border-bottom: 1px solid #2d3a5a;
      margin-bottom: 5px;
    }

    .wgtm-item, .sgtm-item {
      background: #0f3460;
      border: 1px solid #2d3a5a;
      border-radius: 8px;
      padding: 10px;
      font-size: 11px;
    }

    .wgtm-item.error { border-color: #f44336; background: rgba(244, 67, 54, 0.1); }
    .wgtm-item.warning { border-color: #ff9800; background: rgba(255, 152, 0, 0.1); }
    .wgtm-item.success, .sgtm-item.success { border-color: #4caf50; background: rgba(76, 175, 80, 0.1); }

    .wgtm-item-title, .sgtm-item-title {
      font-weight: 600;
      color: #fff;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .wgtm-item-detail, .sgtm-item-detail {
      color: #888;
      font-size: 10px;
    }

    .wgtm-connector, .sgtm-connector {
      display: flex;
      align-items: center;
      justify-content: center;
      color: #4a5a8a;
      font-size: 20px;
    }

    .mini-badge {
      font-size: 9px;
      padding: 2px 5px;
      border-radius: 3px;
      font-weight: 600;
    }

    .mini-badge.error { background: #f44336; color: #fff; }
    .mini-badge.warning { background: #ff9800; color: #fff; }
    .mini-badge.success { background: #4caf50; color: #fff; }

    /* ========== DATA FLOW ========== */
    .data-flow {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .data-flow-row {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 12px 15px;
      background: #0f3460;
      border-radius: 8px;
      border-left: 4px solid;
    }

    .data-flow-row.pass { border-left-color: #4caf50; }
    .data-flow-row.fail { border-left-color: #f44336; }

    .data-flow-event {
      font-family: monospace;
      font-size: 13px;
      color: #2196f3;
      min-width: 120px;
    }

    .data-flow-path {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .data-flow-step {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 600;
    }

    .data-flow-step.pass { background: #1b5e20; color: #81c784; }
    .data-flow-step.fail { background: #b71c1c; color: #ef9a9a; }

    .data-flow-arrow { color: #4a5a8a; }

    .data-flow-result {
      font-size: 11px;
      font-weight: 600;
      min-width: 100px;
      text-align: right;
    }

    .data-flow-result.pass { color: #4caf50; }
    .data-flow-result.fail { color: #f44336; }

    /* ========== PROBLEM CARDS ========== */
    .problems-section {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
    }

    .problem-card {
      background: #16213e;
      border: 1px solid #2d3a5a;
      border-radius: 12px;
      overflow: hidden;
      transition: all 0.3s;
    }

    .problem-card:hover { border-color: #4a5a8a; }
    .problem-card.critical { border-left: 4px solid #f44336; }
    .problem-card.medium { border-left: 4px solid #ff9800; }
    .problem-card.verified { border-left: 4px solid #4caf50; }

    .problem-header {
      padding: 15px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      gap: 8px;
      position: relative;
    }

    .problem-header:hover { background: rgba(255,255,255,0.02); }

    .problem-severity {
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      padding: 3px 8px;
      border-radius: 3px;
      display: inline-block;
      width: fit-content;
    }

    .problem-severity.critical { background: #f44336; color: #fff; }
    .problem-severity.medium { background: #ff9800; color: #fff; }
    .problem-severity.verified { background: #4caf50; color: #fff; }

    .problem-title {
      font-size: 13px;
      font-weight: 600;
      color: #fff;
    }

    .problem-toggle {
      position: absolute;
      top: 15px;
      right: 15px;
      color: #666;
      transition: transform 0.2s;
    }

    .problem-card.expanded .problem-toggle { transform: rotate(180deg); }

    .problem-body {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }

    .problem-card.expanded .problem-body { max-height: 500px; }

    .problem-content {
      padding: 0 15px 15px 15px;
      border-top: 1px solid #2d3a5a;
    }

    .problem-summary {
      font-size: 12px;
      color: #aaa;
      line-height: 1.6;
      padding-top: 15px;
    }

    .problem-code {
      background: #0a0a1a;
      border-radius: 6px;
      padding: 12px;
      margin-top: 12px;
      font-family: monospace;
      font-size: 11px;
      color: #e0e0e0;
      overflow-x: auto;
    }

    .problem-fix {
      background: rgba(76, 175, 80, 0.1);
      border: 1px solid rgba(76, 175, 80, 0.3);
      border-radius: 6px;
      padding: 12px;
      margin-top: 12px;
    }

    .problem-fix-title {
      font-size: 10px;
      font-weight: 600;
      color: #4caf50;
      margin-bottom: 6px;
      text-transform: uppercase;
    }

    .problem-fix-text {
      font-size: 11px;
      color: #81c784;
      line-height: 1.6;
    }

    /* Network & Routing */
    .network-visual, .proxy-routing {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .network-layer, .route-row {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 12px 15px;
      background: #0f3460;
      border-radius: 8px;
    }

    .network-layer-label {
      min-width: 100px;
      font-size: 11px;
      font-weight: 600;
      color: #888;
      text-transform: uppercase;
    }

    .network-components {
      display: flex;
      gap: 15px;
      flex: 1;
    }

    .network-component {
      padding: 10px 15px;
      background: #16213e;
      border: 1px solid #2d3a5a;
      border-radius: 6px;
      font-size: 11px;
    }

    .network-component.active {
      border-color: #4caf50;
      background: rgba(76, 175, 80, 0.1);
    }

    .route-path {
      font-family: monospace;
      font-size: 12px;
      color: #2196f3;
      min-width: 150px;
    }

    .route-arrow { color: #4a5a8a; }

    .route-dest {
      font-size: 12px;
      color: #aaa;
    }

    .route-status {
      margin-left: auto;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 600;
    }

    .route-status.active { background: #1b5e20; color: #81c784; }
  </style>
</head>
<body>
  <!-- Navigation Menu -->
  <nav class="nav-menu">
    <div class="nav-logo">
      <span class="nav-logo-icon">M</span>
      Messer GTM Audit
    </div>
    <div class="nav-links">
      <a href="index.html" class="nav-link">Overview</a>
      <a href="datalayers.html" class="nav-link">DataLayers</a>
      <a href="gtm-audit-view.html" class="nav-link">Audit Map</a>
      <a href="flow.html" class="nav-link">Data Flow</a>
      <a href="canvas.html" class="nav-link">Canvas</a>
      <a href="dashboard.html" class="nav-link active">Dashboard</a>
      <a href="gtm-inventory-enterprise.html" class="nav-link">Inventory</a>
    </div>
    <div class="nav-status">
      <span class="nav-badge critical">1 Critical</span>
      <span class="nav-badge medium">2 Medium</span>
      <span class="nav-badge verified">6 Verified</span>
    </div>
  </nav>

  <div class="canvas-grid">
    <!-- HEADER -->
    <div class="canvas-header">
      <h1 class="canvas-title">Server-Side GTM Audit Dashboard</h1>
      <div class="status-badges">
        <span class="status-badge critical">1 Critical</span>
        <span class="status-badge medium">2 Medium</span>
        <span class="status-badge verified">6 Verified</span>
      </div>
    </div>

    <!-- DIAGRAM 1: END-TO-END FLOW -->
    <div class="diagram-panel full-width">
      <div class="panel-header">
        <span class="icon" style="background:#2196f3;color:#fff;">1</span>
        End-to-End Data Flow - Where It Breaks
      </div>
      <div class="panel-content">
        <div class="e2e-flow">
          <div class="flow-node">
            <div class="flow-node-box source">
              <div class="flow-node-icon">&#127760;</div>
              <div class="flow-node-label">Browser</div>
            </div>
            <div class="flow-node-id">messerattach.com</div>
          </div>
          <div class="flow-arrow success"><span class="flow-arrow-label">dataLayer.push()</span></div>
          <div class="flow-node">
            <div class="flow-node-box source">
              <div class="flow-node-icon">&#128202;</div>
              <div class="flow-node-label">DataLayer</div>
            </div>
            <div class="flow-node-id">WooCommerce</div>
          </div>
          <div class="flow-arrow success"><span class="flow-arrow-label">events captured</span></div>
          <div class="flow-node">
            <div class="flow-node-box wgtm error">
              <div class="flow-node-icon">&#127991;</div>
              <div class="flow-node-label">wGTM</div>
            </div>
            <div class="flow-node-id">GTM-MNRP4PF</div>
          </div>
          <div class="flow-arrow error"><span class="flow-arrow-label">Data Tag BLOCKED</span></div>
          <div class="flow-node">
            <div class="flow-node-box proxy">
              <div class="flow-node-icon">&#9729;</div>
              <div class="flow-node-label">CF Worker</div>
            </div>
            <div class="flow-node-id">/metrics/*</div>
          </div>
          <div class="flow-arrow error"><span class="flow-arrow-label">no requests</span></div>
          <div class="flow-node">
            <div class="flow-node-box sgtm">
              <div class="flow-node-icon">&#128225;</div>
              <div class="flow-node-label">sGTM</div>
            </div>
            <div class="flow-node-id">GTM-K3CQBMZ9</div>
          </div>
          <div class="flow-arrow error"><span class="flow-arrow-label">no events</span></div>
          <div class="flow-node">
            <div class="flow-node-box dest">
              <div class="flow-node-icon">&#128200;</div>
              <div class="flow-node-label">Analytics</div>
            </div>
            <div class="flow-node-id">GA4 / Ads / Meta</div>
          </div>
        </div>
      </div>
    </div>

    <!-- DIAGRAM 2: wGTM INTERNAL -->
    <div class="diagram-panel">
      <div class="panel-header">
        <span class="icon" style="background:#ff9800;color:#fff;">2</span>
        wGTM Internal - Tags & Triggers
      </div>
      <div class="panel-content">
        <div class="wgtm-internal">
          <div class="wgtm-column">
            <div class="wgtm-column-title">Triggers</div>
            <div class="wgtm-item success">
              <div class="wgtm-item-title">ce_ecom <span class="mini-badge success">307</span></div>
              <div class="wgtm-item-detail">Events: core + ecommerce</div>
            </div>
            <div class="wgtm-item success">
              <div class="wgtm-item-title">ce_view_item <span class="mini-badge success">92</span></div>
              <div class="wgtm-item-detail">Event: view_item</div>
            </div>
            <div class="wgtm-item success">
              <div class="wgtm-item-title">ce_add_to_cart <span class="mini-badge success">93</span></div>
              <div class="wgtm-item-detail">Event: add_to_cart</div>
            </div>
            <div class="wgtm-item warning">
              <div class="wgtm-item-title">ce_checkout <span class="mini-badge warning">95</span></div>
              <div class="wgtm-item-detail">Listens: begin_checkout</div>
            </div>
          </div>
          <div class="wgtm-connector">&#8594;</div>
          <div class="wgtm-column">
            <div class="wgtm-column-title">Tags</div>
            <div class="wgtm-item success">
              <div class="wgtm-item-title">Data Tag <span class="mini-badge success">OK</span></div>
              <div class="wgtm-item-detail">Trigger: ce_ecom (307)</div>
              <div class="wgtm-item-detail">Endpoint: /metrics/data</div>
            </div>
            <div class="wgtm-item success">
              <div class="wgtm-item-title">Google Tag <span class="mini-badge success">OK</span></div>
              <div class="wgtm-item-detail">GT-NS9Z5FWG</div>
            </div>
            <div class="wgtm-item success">
              <div class="wgtm-item-title">MS UET Tags <span class="mini-badge success">OK</span></div>
              <div class="wgtm-item-detail">view_item, add_to_cart, checkout</div>
            </div>
          </div>
          <div class="wgtm-connector">&#8594;</div>
          <div class="wgtm-column">
            <div class="wgtm-column-title">Endpoints</div>
            <div class="wgtm-item success">
              <div class="wgtm-item-title">/metrics/data</div>
              <div class="wgtm-item-detail">Core + ecommerce events</div>
            </div>
            <div class="wgtm-item success">
              <div class="wgtm-item-title">/metrics (Google)</div>
              <div class="wgtm-item-detail">server_container_url</div>
            </div>
            <div class="wgtm-item success">
              <div class="wgtm-item-title">bat.bing.com</div>
              <div class="wgtm-item-detail">Microsoft UET direct</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- DIAGRAM 3: sGTM INTERNAL -->
    <div class="diagram-panel">
      <div class="panel-header">
        <span class="icon" style="background:#4caf50;color:#fff;">3</span>
        sGTM Internal - Clients & Tags
      </div>
      <div class="panel-content">
        <div class="sgtm-internal">
          <div class="sgtm-column">
            <div class="sgtm-column-title">Clients</div>
            <div class="sgtm-item success">
              <div class="sgtm-item-title">Stape Data Client <span class="mini-badge success">OK</span></div>
              <div class="sgtm-item-detail">Path: /data</div>
              <div class="sgtm-item-detail">Priority: 102</div>
            </div>
            <div class="sgtm-item success">
              <div class="sgtm-item-title">GA4 Client <span class="mini-badge success">OK</span></div>
              <div class="sgtm-item-detail">Path: /g/collect</div>
            </div>
          </div>
          <div class="sgtm-connector">&#8594;</div>
          <div class="sgtm-column">
            <div class="sgtm-column-title">Variables</div>
            <div class="sgtm-item">
              <div class="sgtm-item-title">EDV - user_id</div>
              <div class="sgtm-item-detail">Event Data Variable</div>
            </div>
            <div class="sgtm-item">
              <div class="sgtm-item-title">EDV - items</div>
              <div class="sgtm-item-detail">Ecommerce items array</div>
            </div>
            <div class="sgtm-item">
              <div class="sgtm-item-title">EDV - value</div>
              <div class="sgtm-item-detail">Transaction value</div>
            </div>
          </div>
          <div class="sgtm-connector">&#8594;</div>
          <div class="sgtm-column">
            <div class="sgtm-column-title">Tags</div>
            <div class="sgtm-item">
              <div class="sgtm-item-title">GA4 Advanced</div>
              <div class="sgtm-item-detail">G-YCL5FGZNCV</div>
            </div>
            <div class="sgtm-item">
              <div class="sgtm-item-title">Google Ads</div>
              <div class="sgtm-item-detail">767740215</div>
            </div>
            <div class="sgtm-item">
              <div class="sgtm-item-title">Facebook CAPI</div>
              <div class="sgtm-item-detail">3695834564032094</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- DIAGRAM 4: DATA FLOW BY EVENT -->
    <div class="diagram-panel full-width">
      <div class="panel-header">
        <span class="icon" style="background:#9c27b0;color:#fff;">4</span>
        Event Data Flow - Per Event Status
      </div>
      <div class="panel-content">
        <div class="data-flow">
          <div class="data-flow-row fail">
            <span class="data-flow-event">view_item</span>
            <div class="data-flow-path">
              <span class="data-flow-step pass">DataLayer</span>
              <span class="data-flow-arrow">&#8594;</span>
              <span class="data-flow-step fail">Data Tag</span>
              <span class="data-flow-arrow">&#8594;</span>
              <span class="data-flow-step fail">/metrics</span>
              <span class="data-flow-arrow">&#8594;</span>
              <span class="data-flow-step fail">sGTM</span>
              <span class="data-flow-arrow">&#8594;</span>
              <span class="data-flow-step fail">GA4</span>
            </div>
            <span class="data-flow-result fail">BLOCKED at wGTM</span>
          </div>
          <div class="data-flow-row fail">
            <span class="data-flow-event">add_to_cart</span>
            <div class="data-flow-path">
              <span class="data-flow-step pass">DataLayer</span>
              <span class="data-flow-arrow">&#8594;</span>
              <span class="data-flow-step fail">Data Tag</span>
              <span class="data-flow-arrow">&#8594;</span>
              <span class="data-flow-step fail">/metrics</span>
              <span class="data-flow-arrow">&#8594;</span>
              <span class="data-flow-step fail">sGTM</span>
              <span class="data-flow-arrow">&#8594;</span>
              <span class="data-flow-step fail">GA4</span>
            </div>
            <span class="data-flow-result fail">BLOCKED at wGTM</span>
          </div>
          <div class="data-flow-row fail">
            <span class="data-flow-event">begin_checkout</span>
            <div class="data-flow-path">
              <span class="data-flow-step pass">DataLayer</span>
              <span class="data-flow-arrow">&#8594;</span>
              <span class="data-flow-step fail">Data Tag</span>
              <span class="data-flow-arrow">&#8594;</span>
              <span class="data-flow-step fail">/metrics</span>
              <span class="data-flow-arrow">&#8594;</span>
              <span class="data-flow-step fail">sGTM</span>
              <span class="data-flow-arrow">&#8594;</span>
              <span class="data-flow-step fail">GA4</span>
            </div>
            <span class="data-flow-result fail">BLOCKED at wGTM</span>
          </div>
          <div class="data-flow-row fail">
            <span class="data-flow-event">view_cart</span>
            <div class="data-flow-path">
              <span class="data-flow-step pass">DataLayer</span>
              <span class="data-flow-arrow">&#8594;</span>
              <span class="data-flow-step fail">Data Tag</span>
              <span class="data-flow-arrow">&#8594;</span>
              <span class="data-flow-step fail">/metrics</span>
              <span class="data-flow-arrow">&#8594;</span>
              <span class="data-flow-step fail">sGTM</span>
              <span class="data-flow-arrow">&#8594;</span>
              <span class="data-flow-step fail">GA4</span>
            </div>
            <span class="data-flow-result fail">BLOCKED at wGTM</span>
          </div>
          <div class="data-flow-row pass">
            <span class="data-flow-event">purchase</span>
            <div class="data-flow-path">
              <span class="data-flow-step pass">DataLayer</span>
              <span class="data-flow-arrow">&#8594;</span>
              <span class="data-flow-step pass">Data Tag</span>
              <span class="data-flow-arrow">&#8594;</span>
              <span class="data-flow-step pass">/metrics</span>
              <span class="data-flow-arrow">&#8594;</span>
              <span class="data-flow-step pass">sGTM</span>
              <span class="data-flow-arrow">&#8594;</span>
              <span class="data-flow-step pass">GA4</span>
            </div>
            <span class="data-flow-result pass">WOULD PASS</span>
          </div>
        </div>
      </div>
    </div>

    <!-- DIAGRAM 5: PROXY ROUTING -->
    <div class="diagram-panel">
      <div class="panel-header">
        <span class="icon" style="background:#e91e63;color:#fff;">5</span>
        Same-Origin Proxy Routing
      </div>
      <div class="panel-content">
        <div class="proxy-routing">
          <div class="route-row">
            <span class="route-path">/metrics/data</span>
            <span class="route-arrow">&#8594;</span>
            <span class="route-dest">sgtm.messerattach.com/data</span>
            <span class="route-status active">ACTIVE</span>
          </div>
          <div class="route-row">
            <span class="route-path">/metrics/g/collect</span>
            <span class="route-arrow">&#8594;</span>
            <span class="route-dest">sgtm.messerattach.com/g/collect</span>
            <span class="route-status active">ACTIVE</span>
          </div>
          <div class="route-row">
            <span class="route-path">/metrics/*</span>
            <span class="route-arrow">&#8594;</span>
            <span class="route-dest">sgtm.messerattach.com/*</span>
            <span class="route-status active">ACTIVE</span>
          </div>
        </div>
      </div>
    </div>

    <!-- DIAGRAM 6: NETWORK LAYERS -->
    <div class="diagram-panel">
      <div class="panel-header">
        <span class="icon" style="background:#607d8b;color:#fff;">6</span>
        Network Infrastructure Status
      </div>
      <div class="panel-content">
        <div class="network-visual">
          <div class="network-layer">
            <span class="network-layer-label">CDN Layer</span>
            <div class="network-components">
              <div class="network-component active">Cloudflare WAF - Exempt</div>
              <div class="network-component active">Cache Bypass - Active</div>
            </div>
          </div>
          <div class="network-layer">
            <span class="network-layer-label">Proxy Layer</span>
            <div class="network-components">
              <div class="network-component active">CF Worker - Routing</div>
              <div class="network-component active">SSL Termination</div>
            </div>
          </div>
          <div class="network-layer">
            <span class="network-layer-label">Cache Layer</span>
            <div class="network-components">
              <div class="network-component active">WP Rocket - Excluded</div>
              <div class="network-component active">Page Cache - Excluded</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- PROBLEM CARDS -->
    <div class="problems-section">
      <div class="problem-card medium expanded" id="card-critical">
        <div class="problem-header" onclick="toggleCard('card-critical')">
          <span class="problem-severity medium">Medium</span>
          <span class="problem-title">Validate Data Tag payloads</span>
          <span class="problem-toggle">&#9660;</span>
        </div>
        <div class="problem-body">
          <div class="problem-content">
            <p class="problem-summary">The wGTM Data Tag (tagId 310) uses trigger ID "307" (ce_ecom). Validate that core + ecommerce events are reaching /metrics/data in sGTM preview.</p>
            <div class="problem-code">firingTriggerId: ["307"]  // ce_ecom

// Validate in sGTM preview:
POST https://messerattach.com/metrics/data</div>
            <div class="problem-fix">
              <div class="problem-fix-title">Validation</div>
              <div class="problem-fix-text">Open sGTM preview and confirm events (view_item, add_to_cart, begin_checkout, purchase) arrive via Data Client.</div>
            </div>
          </div>
        </div>
      </div>

      <div class="problem-card medium" id="card-userid">
        <div class="problem-header" onclick="toggleCard('card-userid')">
          <span class="problem-severity medium">Medium</span>
          <span class="problem-title">Guest user_id tracking</span>
          <span class="problem-toggle">&#9660;</span>
        </div>
        <div class="problem-body">
          <div class="problem-content">
            <p class="problem-summary">Guest UUIDs sent as user_id pollutes GA4 User-ID feature meant for authenticated users.</p>
            <div class="problem-code">{ "event": "user_init", "user_id": "guest_bf8223ea..." }</div>
            <div class="problem-fix">
              <div class="problem-fix-title">Recommendation</div>
              <div class="problem-fix-text">Only send user_id for logged-in users. Use guest_id for guests.</div>
            </div>
          </div>
        </div>
      </div>

      <div class="problem-card medium" id="card-checkout">
        <div class="problem-header" onclick="toggleCard('card-checkout')">
          <span class="problem-severity medium">Medium</span>
          <span class="problem-title">checkout vs begin_checkout</span>
          <span class="problem-toggle">&#9660;</span>
        </div>
        <div class="problem-body">
          <div class="problem-content">
            <p class="problem-summary">DataLayer pushes TWO events: "checkout" (legacy UA) AND "begin_checkout" (GA4). Trigger "ce_checkout" actually listens for "begin_checkout".</p>
            <div class="problem-code">// Legacy: { "event": "checkout" }
// GA4: { "event": "begin_checkout" }</div>
            <div class="problem-fix">
              <div class="problem-fix-title">Recommendation</div>
              <div class="problem-fix-text">Remove legacy "checkout" event. Rename trigger to ce_begin_checkout.</div>
            </div>
          </div>
        </div>
      </div>

      <div class="problem-card verified" id="card-infra">
        <div class="problem-header" onclick="toggleCard('card-infra')">
          <span class="problem-severity verified">Verified OK</span>
          <span class="problem-title">Infrastructure Ready</span>
          <span class="problem-toggle">&#9660;</span>
        </div>
        <div class="problem-body">
          <div class="problem-content">
            <p class="problem-summary">All infrastructure components are correctly configured. Once Data Tag trigger is fixed, events will flow through.</p>
            <div class="problem-code">OK: Cloudflare Worker, Cache Bypass, WAF, WP Rocket, sGTM Data Client, DataLayer Schema</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    function toggleCard(cardId) {
      const card = document.getElementById(cardId);
      card.classList.toggle('expanded');
    }
  </script>
</body>
</html>
